<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¢Ù…Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
  <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØªØ§ Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø¯Ù…ÙŠ -->
  <meta name="theme-color" content="#2c3e50">
  <link rel="manifest" href="manifest.json">

  <!-- Ø¥Ø·Ø§Ø± Ø¹Ù…Ù„ Ø§Ù„ØªØµÙ…ÙŠÙ… (Shoelace) -->
  <link href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/themes/light.css" rel="stylesheet">
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/shoelace.js"></script>
  
  <!-- Ø£Ù†Ù…Ø§Ø· Ù…Ø®ØµØµØ© -->
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --success-color: #27ae60;
      --danger-color: #e74c3c;
      --background-light: #f8f9fa;
      --background-dark: #1a1a1a;
    }

    body {
      font-family: 'Segoe UI', system-ui;
      background: var(--background-light);
      color: var(--primary-color);
      transition: all 0.3s ease;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .security-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .biometric-section {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    }

    .editor-section {
      margin-top: 2rem;
      padding: 1rem;
    }

    #note-editor {
      min-height: 200px;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      padding: 1rem;
      background: #fff;
    }

    /* Ø¯Ø¹Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
    @media (prefers-color-scheme: dark) {
      body {
        background: var(--background-dark);
        color: #fff;
      }
      .biometric-section, .editor-section, #note-editor {
        background: #333;
        border-color: #555;
      }
    }
  </style>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù† -->
  <div class="container" id="auth-container">
    <sl-card class="security-grid">
      <!-- Ù‚Ø³Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ -->
      <div class="biometric-section">
        <h2>ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù†</h2>
        <sl-input type="text" label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" id="username" required></sl-input>
        <sl-input type="password" label="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" id="password" password-toggle required></sl-input>
        
        <!-- Ø£Ø³Ø¦Ù„Ø© Ø£Ù…Ø§Ù† Ù…Ø®ØµØµØ© -->
        <sl-select label="Ø§Ø®ØªØ± Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†" id="security-question">
          <sl-option value="1">Ù…Ø§ Ø§Ø³Ù… Ù…Ø¯Ø±Ø³ØªÙƒ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©ØŸ</sl-option>
          <sl-option value="2">Ù…Ø§ Ù‡Ùˆ Ø£ÙˆÙ„ Ø­ÙŠÙˆØ§Ù† Ø£Ù„ÙŠÙ Ù„ÙƒØŸ</sl-option>
        </sl-select>
        <sl-input type="text" label="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©" id="security-answer" required></sl-input>

        <!-- Ù…ØµØ§Ø¯Ù‚Ø© Ø¨ÙŠÙˆÙ…ØªØ±ÙŠØ© -->
        <sl-button variant="primary" id="biometric-auth">
          <sl-icon name="fingerprint"></sl-icon> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠ
        </sl-button>
      </div>

      <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡ -->
      <div class="biometric-section">
        <h3>ğŸ“¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡</h3>
        <video id="face-video" width="300" height="225" autoplay muted playsinline></video>
        <canvas id="face-canvas" width="300" height="225" hidden></canvas>
        <sl-button id="start-face-auth">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­</sl-button>
      </div>
    </sl-card>
  </div>

  <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div class="container" id="main-app" hidden>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
    <sl-toolbar>
      <sl-dropdown>
        <sl-button slot="trigger" caret>Ù…Ù„Ù</sl-button>
        <sl-menu>
          <sl-menu-item id="new-note">Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</sl-menu-item>
          <sl-menu-item id="import">Ø§Ø³ØªÙŠØ±Ø§Ø¯</sl-menu-item>
          <sl-menu-divider></sl-menu-divider>
          <sl-menu-item id="logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</sl-menu-item>
        </sl-menu>
      </sl-dropdown>

      <!-- Ø§Ù„ØªØ­ÙƒÙ… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª -->
      <sl-select id="language-select" value="ar" style="width: 120px;">
        <sl-option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</sl-option>
        <sl-option value="en">English</sl-option>
        <sl-option value="fr">FranÃ§ais</sl-option>
        <sl-option value="es">EspaÃ±ol</sl-option>
      </sl-select>

      <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù…Ø§Ù† -->
      <sl-button-group>
        <sl-button id="2fa-setup">Ø¥Ø¹Ø¯Ø§Ø¯ 2FA</sl-button>
        <sl-button variant="danger" id="lock-session">Ù‚ÙÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©</sl-button>
      </sl-button-group>
    </sl-toolbar>

    <!-- Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
    <sl-card class="editor-section">
      <div id="note-editor" contenteditable="true" data-placeholder="Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù‡Ù†Ø§..."></div>
      <sl-button-group>
        <sl-button variant="success" id="save-note">Ø­ÙØ¸</sl-button>
        <sl-button variant="primary" id="archive-note">Ø£Ø±Ø´ÙØ©</sl-button>
        <sl-button variant="danger" id="delete-note">Ø­Ø°Ù</sl-button>
      </sl-button-group>
    </sl-card>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ -->
    <sl-card>
      <sl-input id="search-input" type="search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ..."></sl-input>
      <div id="archive-results"></div>
    </sl-card>
  </div>

  <!-- Ø¹Ù†ØµØ± Ø­ÙˆØ§Ø± (Modal) Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
  <sl-dialog label="ØªÙ†Ø¨ÙŠÙ‡" id="modal-dialog">
    <div id="modal-content"></div>
    <sl-button slot="footer" variant="primary" id="close-modal">Ø­Ø³Ù†Ù‹Ø§</sl-button>
  </sl-dialog>

  <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø© ÙˆØ§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡ -->
  <script src="https://cdn.jsdelivr.net/npm/i18next@21.6.10/i18next.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

  <script>
    'use strict';

    class SecureNotesSystem {
      constructor() {
        this.encryptionKey = null;
        this.iv = CryptoJS.lib.WordArray.random(16);
        this.currentUser = null;
        this.sessionTimeout = null;
        this.modelsPath = '/models'; // ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆÙØ± Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡

        this.initI18n();
        this.initEventListeners();
        this.initFaceRecognition();
        this.registerServiceWorker();
      }

      /* ========== Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø© ========== */
      initI18n() {
        i18next.init({
          lng: 'ar',
          debug: false,
          resources: {
            ar: { translation: {
              login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù†",
              username: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
              password: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
              securityQuestion: "Ø§Ø®ØªØ± Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†",
              securityAnswer: "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©",
              faceAuth: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡",
              startScan: "Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­",
              newNote: "Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©",
              import: "Ø§Ø³ØªÙŠØ±Ø§Ø¯",
              logout: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
              setup2FA: "Ø¥Ø¹Ø¯Ø§Ø¯ 2FA",
              lockSession: "Ù‚ÙÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©",
              save: "Ø­ÙØ¸",
              archive: "Ø£Ø±Ø´ÙØ©",
              delete: "Ø­Ø°Ù",
              search: "Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ..."
            }},
            en: { translation: {
              login: "Secure Login",
              username: "Username",
              password: "Password",
              securityQuestion: "Select a Security Question",
              securityAnswer: "Answer",
              faceAuth: "Face Recognition Login",
              startScan: "Start Scan",
              newNote: "New Note",
              import: "Import",
              logout: "Logout",
              setup2FA: "Setup 2FA",
              lockSession: "Lock Session",
              save: "Save",
              archive: "Archive",
              delete: "Delete",
              search: "Search Archive..."
            }}
          }
        }, () => {
          // ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© i18n
          this.updateTranslations();
        });
      }

      updateTranslations() {
        // Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ ØªØ­Ø¯ÙŠØ« Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ± (ÙŠÙ…ÙƒÙ† ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©)
        document.querySelector('#auth-container h2').innerText = i18next.t('login');
        document.querySelector('sl-input[label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"]').label = i18next.t('username');
        document.querySelector('sl-input[label="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"]').label = i18next.t('password');
      }

      /* ========== ØªØ³Ø¬ÙŠÙ„ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ========== */
      initEventListeners() {
        document.getElementById('biometric-auth').addEventListener('click', () => this.handleBiometricAuth());
        document.getElementById('start-face-auth').addEventListener('click', () => this.faceLogin());
        document.getElementById('2fa-setup').addEventListener('click', () => this.setup2FA());
        document.getElementById('lock-session').addEventListener('click', () => this.lockSession());
        document.getElementById('logout').addEventListener('click', () => this.logout());
        document.getElementById('save-note').addEventListener('click', () => this.saveNote());
        document.getElementById('close-modal').addEventListener('click', () => this.closeModal());

        // ØªØºÙŠÙŠØ± Ù„ØºØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù„ØºØ© Ø¬Ø¯ÙŠØ¯Ø©
        document.getElementById('language-select').addEventListener('sl-change', (event) => {
          const newLang = event.detail.value;
          i18next.changeLanguage(newLang, () => {
            this.updateTranslations();
          });
        });

        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù…Ø¤Ù‚Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø§ÙˆØ³
        window.addEventListener('mousemove', () => this.resetSessionTimer());

        // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
        document.getElementById('note-editor').addEventListener('input', () => {
          this.autoSaveNote();
        });
      }

      /* ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡ ========== */
      async initFaceRecognition() {
        try {
          await faceapi.nets.tinyFaceDetector.loadFromUri(this.modelsPath);
          const video = document.getElementById('face-video');
          const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
          video.srcObject = stream;
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡:', error);
          this.showModal('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡.');
        }
      }

      /* ========== ØªØ³Ø¬ÙŠÙ„ Ø®Ø¯Ù…Ø© (Service Worker) Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø¯Ù…ÙŠ ========== */
      registerServiceWorker() {
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js').then(registration => {
              console.log('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­:', registration);
            }).catch(error => {
              console.error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
            });
          });
        }
      }

      /* ========== Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠ ========== */
      async handleBiometricAuth() {
        try {
          if (navigator.credentials && navigator.credentials.get) {
            // ØªÙˆÙ„ÙŠØ¯ ØªØ­Ø¯ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Crypto API
            const challenge = new Uint8Array(32);
            window.crypto.getRandomValues(challenge);
            const credential = await navigator.credentials.get({
              publicKey: {
                challenge: challenge,
                rpId: window.location.hostname,
                userVerification: 'required'
              }
            });
            this.handleAuthSuccess(credential);
          } else {
            this.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠ.');
          }
        } catch (error) {
          console.error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠØ©:', error);
          this.showModal('Ø®Ø·Ø£', 'ÙØ´Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠØ©.');
        }
      }

      /* ========== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ ========== */
      handleAuthSuccess(credential) {
        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
        this.currentUser = document.getElementById('username').value || "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…";
        // ØªÙˆÙ„ÙŠØ¯ Ù…ÙØªØ§Ø­ ØªØ´ÙÙŠØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CryptoJS (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø£ÙƒØ«Ø± ØªØ·ÙˆØ±Ù‹Ø§)
        this.encryptionKey = CryptoJS.lib.WordArray.random(16).toString();
        document.getElementById('auth-container').hidden = true;
        document.getElementById('main-app').hidden = false;
        this.resetSessionTimer();
        this.loadSavedNote();
        this.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.');
      }

      /* ========== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡ ========== */
      async faceLogin() {
        try {
          const video = document.getElementById('face-video');
          const canvas = document.getElementById('face-canvas');
          const context = canvas.getContext('2d');
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          const detections = await faceapi.detectAllFaces(canvas, new faceapi.TinyFaceDetectorOptions());
          
          if (detections.length > 0) {
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙŠØ²Ø§Øª Ø§Ù„ÙˆØ¬Ù‡ (ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯Ù‚Ø©)
            const faceData = detections[0];
            this.verifyFace(faceData);
          } else {
            this.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† ÙˆØ¬Ù‡. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
          }
        } catch (error) {
          console.error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡:', error);
          this.showModal('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡.');
        }
      }

      /* ========== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ¬Ù‡ (Ù…Ø¤Ù‚Øª Ù„Ù„Ø¥ÙŠØ¶Ø§Ø­) ========== */
      verifyFace(faceData) {
        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ØªØ­Ù‚Ù‚ Ù…ØªÙ‚Ø¯Ù…Ø© Ù‡Ù†Ø§
        if (faceData) {
          // Ø§Ø¹ØªØ¨Ø§Ø±Ù‹Ø§ Ù…Ù† Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù†Ø§Ø¬Ø­
          this.handleAuthSuccess(faceData);
        } else {
          this.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.');
        }
      }

      /* ========== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (2FA) ========== */
      setup2FA() {
        // ØªÙˆÙ„ÙŠØ¯ Ù…ÙØªØ§Ø­ Ø³Ø±ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Crypto API
        const secret = this.generateSecret(32);
        const qrCodeData = `otpauth://totp/NotesApp?secret=${secret}&issuer=SecureNotes`;
        const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(qrCodeData)}`;
        this.showModal('QR Code', `<img src="${qrImageUrl}" alt="QR Code Ù„ØªÙØ¹ÙŠÙ„ 2FA">`);
      }

      /* ========== ØªÙˆÙ„ÙŠØ¯ Ù…ÙØªØ§Ø­ Ø³Ø±ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Crypto API ========== */
      generateSecret(length = 32) {
        const array = new Uint8Array(length);
        window.crypto.getRandomValues(array);
        return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
      }

      /* ========== Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¤Ù‚Øª Ø§Ù„Ø¬Ù„Ø³Ø© ========== */
      resetSessionTimer() {
        clearTimeout(this.sessionTimeout);
        this.sessionTimeout = setTimeout(() => {
          this.lockSession();
        }, 300000); // 5 Ø¯Ù‚Ø§Ø¦Ù‚
      }

      lockSession() {
        document.getElementById('main-app').hidden = true;
        document.getElementById('auth-container').hidden = false;
        this.encryptionKey = null;
        this.currentUser = null;
        this.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·.');
      }

      logout() {
        this.lockSession();
        this.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­.');
      }

      /* ========== ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CryptoJS ========== */
      encryptData(data) {
        if (!this.encryptionKey) return null;
        return CryptoJS.AES.encrypt(JSON.stringify(data), this.encryptionKey, { iv: this.iv }).toString();
      }

      /* ========== ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ========== */
      decryptData(ciphertext) {
        try {
          const bytes = CryptoJS.AES.decrypt(ciphertext, this.encryptionKey, { iv: this.iv });
          return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±:', error);
          return null;
        }
      }

      /* ========== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Regex ========== */
      validateInput(data) {
        const schema = {
          name: /^[\p{L} ]+$/u,
          birthDate: /^\d{4}-\d{2}-\d{2}$/
          // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ù†Ø§
        };

        return Object.entries(schema).every(([key, regex]) => regex.test(data[key]));
      }

      /* ========== Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ========== */
      autoSaveNote() {
        const noteContent = document.getElementById('note-editor').innerHTML;
        localStorage.setItem('savedNote', noteContent);
      }

      loadSavedNote() {
        const savedNote = localStorage.getItem('savedNote');
        if (savedNote) {
          document.getElementById('note-editor').innerHTML = savedNote;
        }
      }

      saveNote() {
        this.autoSaveNote();
        this.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­.');
      }

      /* ========== Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø­ÙˆØ§Ø± (Modal) Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ========== */
      showModal(title, content) {
        const modal = document.getElementById('modal-dialog');
        modal.label = title;
        document.getElementById('modal-content').innerHTML = content;
        modal.show();
      }

      closeModal() {
        document.getElementById('modal-dialog').hide();
      }
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('DOMContentLoaded', () => {
      window.app = new SecureNotesSystem();
    });
  </script>
</body>
</html>
